var w=Object.defineProperty;var v=(s,o,e)=>o in s?w(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e;var a=(s,o,e)=>(v(s,typeof o!="symbol"?o+"":o,e),e),f=(s,o,e)=>{if(!o.has(s))throw TypeError("Cannot "+e)};var h=(s,o,e)=>(f(s,o,"read from private field"),e?e.call(s):o.get(s)),d=(s,o,e)=>{if(o.has(s))throw TypeError("Cannot add the same private member more than once");o instanceof WeakSet?o.add(s):o.set(s,e)};import{E as k,q as u,w as c,s as p}from"./game.86b6fc01.js";import{Movement as y}from"./movement.cd205329.js";import{G as b}from"./script.1f479a83.js";import{smoothCamera as L,SmoothCamera as A}from"./smoothCamera.d2004ac1.js";var i;class l extends p{constructor(e){super();d(this,i,new Map);for(const t in e){const r=e[t];for(const n of r)h(this,i).set(n,t)}}process_keyboard_event(e,t){const r=h(this,i).get(`${e}_${t}`);r&&this.emit(r)}}i=new WeakMap;class S extends b{constructor(){super(...arguments);a(this,"keyState",new Map);a(this,"moveForward",!1);a(this,"moveBackward",!1);a(this,"moveLeft",!1);a(this,"moveRight",!1);a(this,"wantsToJump",!1);a(this,"sprint",!1);a(this,"minPolarAngle",0);a(this,"maxPolarAngle",Math.PI);a(this,"euler",new k(0,0,0,"YXZ"))}initialize(){u.on("startLoop",()=>{document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}),u.on("stopLoop",()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)})}every_frame(e){for(const[t,r]of this.keyState);c.do_with([y],([t])=>{t.moveForward=this.moveForward,t.moveBackward=this.moveBackward,t.moveLeft=this.moveLeft,t.moveRight=this.moveRight,t.wantsToJump=this.wantsToJump,t.sprinting=this.sprint,t.euler=this.euler})}onMouseMove({movementX:e,movementY:t}){const[{object:r}]=c.get(L,[A]);this.euler.setFromQuaternion(r.quaternion);const n=.002;this.euler.y-=e*n,this.euler.x-=t*n;const m=Math.PI/2;this.euler.x=Math.max(m-this.maxPolarAngle,Math.min(m-this.minPolarAngle,this.euler.x)),r.quaternion.setFromEuler(this.euler)}onKeyDown(e){const{key:t}=e;switch(this.keyState.set(t,!0),c.do_with([l],([r])=>{r.process_keyboard_event(e.key,"down")}),t){case"ArrowUp":case"w":this.moveForward=!0;break;case"ArrowLeft":case"a":this.moveLeft=!0;break;case"ArrowDown":case"s":this.moveBackward=!0;break;case"ArrowRight":case"d":this.moveRight=!0;break;case" ":this.wantsToJump=!0;break;case"Shift":this.sprint=!0;break;case"Escape":document.exitPointerLock();break;case"Delete":location.reload();break}}onKeyUp({key:e}){switch(this.keyState.set(e,!1),c.do_with([l],([t])=>{t.process_keyboard_event(e,"up")}),e){case"ArrowUp":case"w":this.moveForward=!1;break;case"ArrowLeft":case"a":this.moveLeft=!1;break;case"ArrowDown":case"s":this.moveBackward=!1;break;case"ArrowRight":case"d":this.moveRight=!1;break;case" ":this.wantsToJump=!1;break;case"Shift":this.sprint=!1;break}}}export{l as KeyboardControls,S as default};
